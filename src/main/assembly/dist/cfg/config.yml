#
# dd-dataverse-ingest configuration file
#

#
# See https://www.dropwizard.io/en/latest/manual/configuration.html#server
#
server:
  applicationContextPath: /
  adminContextPath: /
  applicationConnectors:
    - type: http
      port: 20360
  adminConnectors:
    - type: http
      port: 20361

#
# Parameters related to communication with the Dataverse instance
#
dataverse:
  baseUrl: 'http://localhost:8080'
  apiKey: 'changeme'
  awaitLockStateMaxNumberOfRetries: 30
  awaitLockStateMillisecondsBetweenRetries: 500
  httpClient:
    timeout: 30s
    connectionTimeout: 15s
    connectionRequestTimeout: 15s
    timeToLive: 1h
    retries: 2
    userAgent: dd-dataverse-ingest
#
# Settings related to ingest services.
#
ingest:
  # Deposits dropped in the inbox will automatically be picked up and processed by the ingest service.
  autoIngest:
    inbox: /var/opt/dans.knaw.nl/tmp/auto-ingest/inbox
    outbox: /var/opt/dans.knaw.nl/tmp/auto-ingest/outbox
  # Import of migration deposits. This area is used to migrate datasets from EASY to Dataverse and differs from import only in the way the DANS deposits are converted
  # to Dataverse Ingest deposits.
  migration:
    inbox: /var/opt/dans.knaw.nl/tmp/migration/deposits
    outbox: /var/opt/dans.knaw.nl/tmp/migration/out
  # Import of deposits. This area is used for manual bulk imports of deposits.
  import:
    inbox: /var/opt/dans.knaw.nl/tmp/import/inbox
    outbox: /var/opt/dans.knaw.nl/tmp/import/outbox
  tempDir: /var/opt/dans.knaw.nl/tmp/zip-wrapping
  #
  # If some of the metadata blocks are secured with a secret key, the key must be included in the metadataKeys map below, as follows:
  #
  # metadataKeys:
  #    <metadata-block-name>: '<secret-key-value>'
  #
  metadataKeys: { }
  #
  # The maximum number of files that the service will upload in a single batch. If :ZipUploadFilesLimit is set to a lower number than this,
  # the lower number will be used, so that Dataverse will not include the batch as one zip file in the dataset instead of unpacking it.
  #
  # See: https://guides.dataverse.org/en/latest/installation/config.html#zipuploadfileslimit
  #
  maxNumberOfFilesPerUploadBatch: 1000
  waitForReleasedState:
    # 10s * 360 = 1 hour
    maxNumberOfRetries: 360
    timeBetweenChecks: 10s

#
# Settings related to the conversion of deposits from the legacy format to the format used by the ingest service. Set to null to disable.
#
dansDepositConversion:
  #
  # Filtering. Files with a path matching the pattern will not be added to the dataset. Renaming/moving files is not affected.
  # By default, no files are excluded.
  #
  fileExclusionPattern: a^

  #
  # Map from depositor.userId to organization name. Used to fill in the dansDataSupplier metadata field. If there is no
  # entry for a depositor, dansDataSupplier will be left empty.
  #
  dataSuppliers: { }
  # user001: The Organization Name

  #
  # If true, try to deduplicate multi-value metadata fields. If false, do not deduplicate.
  #
  deduplicate: false

  #
  # The directory where various metadata term mappings are stored.
  #
  mappingDefsDir: /etc/opt/dans.knaw.nl/dd-dataverse-ingest

  #
  # List of fields to skip, even when they are in active metadata blocks. This can be used if hidden fields in active metadata blocks are the target of a mapping. Normally, the mapping
  # would be applied to the hidden field. This leads to values that are displayed but cannot be edited (the normal Dataverse behavior for hidden fields). In cases where this is not desired,
  # the field can be skipped by adding it to the list below.
  #
  skipFields: [ ]


#
# See https://www.dropwizard.io/en/latest/manual/configuration.html#logging
#
logging:
  level: INFO
  appenders:
    - type: file
      archive: false
      timeZone: system
      currentLogFilename: /var/opt/dans.knaw.nl/log/dd-dataverse-ingest/dd-dataverse-ingest.log
  loggers:
    'org.hibernate.engine.internal.StatisticalLoggingSessionEventListener': 'OFF'
